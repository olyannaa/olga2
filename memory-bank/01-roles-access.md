# Роли и доступ

## Системные роли (глобальные)
- Администратор (`admin`): полный доступ к данным и настройкам.
  - Полный админ: без закрепленных подразделений (`departmentIds` пусто) — доступ ко всем проектам, пользователям и контрагентам.
  - Админ со скоупом: есть `departmentIds` — доступ ограничен проектами и пользователями своих подразделений.
  - Флаг `canApproveSubcontracts` включает доступ к разделу «Заявки» и согласованию субподрядов по своим подразделениям.
- ГИП (`gip`): создает проекты только в своих подразделениях, становится менеджером проекта, управляет своими проектами; видит аналитику и бюджет по своим проектам.
- Исполнитель (`executor`): работает с задачами и таймшитами в пределах назначенных проектов; видит свои задачи и проекты.
- Бухгалтер (`accountant`): видит проекты на чтение, имеет доступ к таймшитам всех сотрудников; может просматривать/редактировать сотрудников (кроме админов) через UI «Структура организации».

## Проектные роли (project_members.project_role)
- Руководитель проекта (`manager`): полный контроль проекта (свойства, WBS, задачи, команда, субподряды).
- Главный специалист (`lead_specialist`): управление WBS/задачами/командой, создание субподрядов; без доступа к бюджету и полным затратам.
- Исполнитель (`executor`): просмотр проекта и управление назначенными задачами; без редактирования свойств/команды.
- Бухгалтер (`accountant`): чтение проекта и бухгалтерских задач; без права редактирования проекта.

## Особые правила
- Пользователь может иметь несколько системных ролей; доступ определяется объединением прав.
- Контрагентский пользователь (`contractor_id`): всегда `executor`, без подразделений; отображается с бейджем «контрагент».
- Системная роль управляет доступом вне проекта, проектная роль — внутри конкретного проекта.

## Матрица доступа (высокий уровень)
Обозначения: П = полный доступ, Р = просмотр, О = ограниченный (свои/назначенные), Н = нет.

| Модуль | admin | gip | executor | accountant |
| --- | --- | --- | --- | --- |
| Организация (пользователи/подразделения/контрагенты) | П (со скоупом — в своих департаментах) | Н | Н | Р/О (без админов) |
| Проекты | П (со скоупом — в своих департаментах) | П (свои проекты) | Р (проекты участника) | Р (все проекты) |
| WBS/разделы | П | П (свои проекты) | Р | Р |
| Задачи | П | П (свои проекты) | Р (все задачи проекта); О (изменение своих) | Р/О (свои бухгалтерские задачи) |
| Таймшиты | П | Р (свои + участники своих проектов) | О (свои) | Р (все) |
| Субподряды (создание) | П (если manager/lead) | П (если manager) | Н | Н |
| Субподряды (согласование) | П (если `canApproveSubcontracts`) | Н | Н | Н |
| Файлы проекта | П (кроме ограничения для бухгалтера) | О (по проекту) | О (по проекту) | Р (без редактирования) |
| Чат проекта | П | П | О (по проекту) | О (если добавлен в проект) |
| Аналитика | П | П (свои проекты) | Н | П |
