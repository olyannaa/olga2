# Сценарии проверки изменений v2 (до 20)

1. Миграция ролей approval_admin -> admin
   - Шаги: выполнить миграции на копии базы; найти пользователей с ролью `approval_admin`.
   - Ожидание: у этих пользователей есть роль `admin` и `can_approve_subcontracts=true`; старая роль сохранена для совместимости.

2. Миграция ролей department_head -> admin
   - Шаги: выполнить миграции на копии базы; найти пользователей с ролью `department_head`.
   - Ожидание: у этих пользователей есть роль `admin`, `can_approve_subcontracts=false`, `user_departments` сохранены.

3. Проверка project_role enum
   - Шаги: проверить enum `project_role` в БД; открыть UI добавления участника в проект.
   - Ожидание: доступны роли проекта `lead_specialist` и `accountant` (если предусмотрено UI/ACL).

4. Ограничение админа по подразделениям (бывший department_head)
   - Шаги: войти пользователем из сценария 2; открыть список проектов; попробовать открыть проект другого подразделения.
   - Ожидание: видит только проекты своих подразделений; доступ к чужому проекту запрещен/отсутствует.

5. Доступ к согласованиям только через can_approve_subcontracts
   - Шаги: войти админом без флага; открыть `/approvals` и вызвать API `/subcontracts/requests`.
   - Ожидание: в UI нет пункта “Заявки”; API запрещает доступ.

6. Согласования доступны бывшему approval_admin
   - Шаги: войти пользователем из сценария 1; открыть `/approvals`.
   - Ожидание: доступ есть; можно согласовать/отклонить заявку.

7. ГИП (project_manager) создает проект
   - Шаги: войти пользователем `project_manager`; создать проект.
   - Ожидание: проект создается; пользователь назначен руководителем и имеет полный доступ в проекте.

8. Главспец управляет задачами, но без бюджета/аналитики
   - Шаги: войти `lead_specialist`; открыть проект; перейти в аналитику/бюджет.
   - Ожидание: управление задачами доступно; бюджет и аналитика скрыты.

9. Исполнитель видит только свои задачи
   - Шаги: войти `executor`; открыть общий список задач и проектный канбан.
   - Ожидание: доступны только свои задачи; задачи бухгалтера скрыты.

10. Бухгалтер двигает свои задачи в проектном канбане
    - Шаги: войти `accountant`; открыть канбан проекта; попробовать перетаскивание своей и чужой задачи.
    - Ожидание: свои задачи двигаются; чужие — нет.

11. Создание субподряда из “Свойств проекта”
    - Шаги: войти `admin`/`project_manager`; создать субподряд в свойствах проекта.
    - Ожидание: задача создается в “Свойствах”, отображается серой, `approval_status=pending`.

12. Доступ к субподряду до/после согласования
    - Шаги: войти исполнителем подрядчика; открыть задачу субподряда до и после 2 согласований.
    - Ожидание: до согласований задача недоступна/скрыта; после — доступна в задачах/таймшитах.

13. Таймшиты: “+” на уровне проекта
    - Шаги: войти `project_manager`/`admin`; в табеле поставить “+” по проекту.
    - Ожидание: создается/используется `project_time` запись; отображение в табеле корректно.

14. Таймшиты: статусы дня по клику на дату
    - Шаги: кликнуть по дате (не по задаче) и пройти цикл b/k/o/v.
    - Ожидание: меняется статус дня; трудозатраты на эту дату очищаются.

15. WBS сортировка подразделов
    - Шаги: создать разделы 1.2 и 1.1; обновить список.
    - Ожидание: отображение отсортировано как 1.1, 1.2.

16. WBS ограничение глубины до 3 уровней
    - Шаги: попытаться создать 4-й уровень (например 1.1.1.1).
    - Ожидание: операция запрещена с понятной ошибкой.

17. Подтверждение удаления
    - Шаги: удалить проект/участника/подрядчика/сотрудника/раздел WBS/задачу.
    - Ожидание: всегда есть диалог “Удалить?” с “Да/Отмена”; отмена не удаляет данные.

18. Кнопка “Новая задача” в проектном канбане
    - Шаги: открыть канбан проекта любой ролью.
    - Ожидание: кнопка отсутствует, остальные функции канбана работают.

19. Звездочки обязательных полей
    - Шаги: открыть формы создания проекта/задачи/сотрудника/контрагента.
    - Ожидание: обязательные поля помечены “*”, валидация соответствует UI.

20. Диаграмма Ганта: проверка верстки
    - Шаги: открыть Гант; переключить day/week/month; протестировать мобильную ширину.
    - Ожидание: верстка не ломается, полосы совпадают с датами.
