# Предпрод‑сценарии (актуальные)

Формат: **роль/цель → шаги → ожидаемо**. Пользователь авторизован.

1) **RBAC: доступ к ключевым экранам и прямым URL.**  
   Роль/цель: admin/gip/executor/accountant → перейти на `/approvals`, `/organization`, `/settings`, `/projects/:id` → ожидаемо:  
   - `/approvals` доступен только admin с `canApproveSubcontracts`;  
   - `/organization` доступен admin/accountant;  
   - `/settings` доступен всем;  
   - `/projects/:id` доступен участникам проекта, admin, accountant.

2) **Проект: создание + корректные атрибуты.**  
   Роль/цель: admin/gip → создать проект с подразделением, менеджером, бюджетом, сроками, ссылкой → ожидаемо: проект появляется в списке, атрибуты сохранены.

3) **Проект: архивирование и восстановление.**  
   Роль/цель: admin → архивировать проект → проверить вкладку «Архив» → восстановить → ожидаемо: проект возвращается в активные.

4) **Команда проекта: роли и права.**  
   Роль/цель: manager → назначить `lead_specialist` и `executor` → ожидаемо: lead может править WBS/задачи, executor не может редактировать свойства проекта.

5) **WBS: импорт шаблона и сортировка.**  
   Роль/цель: manager/lead_specialist → загрузить шаблон WBS → ожидаемо: коды сортируются корректно (1.1, 1.2, 2.1).

6) **WBS: ограничение глубины.**  
   Роль/цель: manager/lead_specialist → попытаться создать 4‑й уровень → ожидаемо: ошибка, глубина максимум 3.

7) **WBS‑раздел → задача: корректная связка.**  
   Роль/цель: manager → создать/изменить раздел → ожидаемо: связанная задача появляется в проектном канбане и «Моих задачах», редактирование задачи вне WBS запрещено.

8) **Проектные задачи: создание вручную vs WBS.**  
   Роль/цель: manager → создать задачу вне WBS → отредактировать/удалить → ожидаемо: ручные задачи редактируются, WBS‑задачи нет.

9) **Субподряд: создание из раздела.**  
   Роль/цель: manager/lead_specialist → создать субподряд по разделу с ценой и исполнителем → ожидаемо: статус `pending`, заявка появляется в списке.

10) **Субподряд: согласование.**  
    Роль/цель: admin + `canApproveSubcontracts` → утвердить с финальной стоимостью → ожидаемо: `approved`, бейдж «Субподряд» в таблице разделов и на канбане, задача доступна исполнителю.

11) **Субподряд: отклонение.**  
    Роль/цель: approver → отклонить → ожидаемо: `rejected`, задача скрыта, перемещение по статусам недоступно.

12) **Мои задачи: фильтр исполнителя (ГИП).**  
    Роль/цель: gip → открыть `/tasks` → ожидаемо: показаны только задачи, где он исполнитель.

13) **Канбан проекта: визуальные индикаторы.**  
    Роль/цель: участник проекта → открыть канбан → ожидаемо: бейдж «Субподряд», имя исполнителя, tooltip на аватаре.

14) **Перемещение статусов: ограничения.**  
    Роль/цель: executor → попытаться перетащить `pending`‑субподряд → ожидаемо: запрещено; `approved`‑субподряд перетаскивается.

15) **Таймшит: основная вкладка и project_time.**  
    Роль/цель: admin/gip → открыть «Основные» → ожидаемо: доступна строка проекта и «+» для project_time.

16) **Таймшит: вкладка «Субподряд» у admin/gip.**  
    Роль/цель: admin/gip → открыть вкладку «Субподряд» → ожидаемо: видны только проекты с субподрядными задачами.

17) **Таймшит: фильтр для бухгалтера.**  
    Роль/цель: accountant → открыть таймшит → ожидаемо: отображаются только проекты с назначенными бухгалтерскими задачами.

18) **Таймшит: изменение статуса исполнителем.**  
    Роль/цель: executor → сменить статус своей задачи → ожидаемо: селект активен только для своих задач.

19) **Таймшит: смена режима и day‑off.**  
    Роль/цель: любой → переключить Месяц/Неделя, проставить б/к/о/в → ожидаемо: режим меняется, day‑off очищает записи дня.

20) **Файлы проекта: UI.**  
    Роль/цель: участник проекта → открыть вкладку «Файлы» → ожидаемо: раздел в статусе stub (UI не реализован).

21) **Файлы задач: отображение.**  
    Роль/цель: участник → открыть карточку задачи с файлами → ожидаемо: файлы отображаются; загрузка только через API.

22) **Чат проекта.**  
    Роль/цель: два участника проекта → отправить сообщения → ожидаемо: сообщения отображаются в правильном порядке.

23) **Оргструктура: пользователи и подразделения.**  
    Роль/цель: admin → создать подразделение, назначить пользователю 2 подразделения и primary → ожидаемо: отображение корректно, primary учитывается.

24) **Контрагенты: связка с пользователями.**  
    Роль/цель: admin → создать контрагента, назначить исполнителя → ожидаемо: бейдж «контрагент» виден в проекте/канбане.

25) **Ограничения удаления: задачи с трудозатратами.**  
    Роль/цель: manager/admin → попытаться удалить задачу с time entries → ожидаемо: удаление запрещено.
